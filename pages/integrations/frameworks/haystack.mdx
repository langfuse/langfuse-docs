---
source: Jupyter Notebook
title: "Observability for Haystack with Langfuse"
sidebarTitle: Haystack
description: "Integrate Langfuse with Haystack, the open-source Python framework for building LLM applications. Monitor pipelines, agents, and RAG systems with automatic tracing."
category: Integrations
logo: /images/integrations/haystack_icon.png
---

# Observability for Haystack

This cookbook demonstrates how to use [Langfuse](https://langfuse.com) to gain real-time observability for your [Haystack Application](https://haystack.deepset.ai/).

## What is Haystack?

[Haystack](https://haystack.deepset.ai/) is the open-source Python framework developed by [deepset](https://www.deepset.ai/) for building production-ready LLM applications. Its modular, pipeline-based architecture makes it a popular choice for building RAG systems, search engines, and AI agents.

Key features of Haystack:
- **Pipeline architecture** â€” Build complex workflows by connecting modular components (retrievers, generators, readers, rankers)
- **Agent support** â€” Create AI agents with tool use, planning, and multi-step reasoning
- **Multiple backends** â€” Integrates with Hugging Face Transformers, Elasticsearch, OpenSearch, OpenAI, Cohere, Anthropic, and others
- **Document stores** â€” Connect to vector databases like Pinecone, Weaviate, Qdrant, and Chroma for RAG applications
- **Extensible** â€” Create custom components that plug into the pipeline system
- **Production-ready** â€” Designed for scalable, production deployments with evaluation and monitoring support

> **What is Langfuse?** [Langfuse](https://langfuse.com) is the open source LLM engineering platform. It helps teams to collaboratively manage prompts, trace applications, debug problems, and evaluate their LLM system in production.

## Get Started

We'll walk through a simple example of using Haystack and integrating it with Langfuse.

<Steps>
### Step 1: Install Dependencies


```python
%pip install haystack-ai langfuse openinference-instrumentation-haystack
```

### Step 2: Set Up Environment Variables

Configure your Langfuse API keys. You can get them by signing up for [Langfuse Cloud](https://cloud.langfuse.com) or [self-hosting Langfuse](https://langfuse.com/self-hosting).


```python
import os

# Get keys for your project from the project settings page: https://cloud.langfuse.com
os.environ["LANGFUSE_PUBLIC_KEY"] = "pk-lf-..." 
os.environ["LANGFUSE_SECRET_KEY"] = "sk-lf-..." 
os.environ["LANGFUSE_BASE_URL"] = "https://cloud.langfuse.com" # ðŸ‡ªðŸ‡º EU region
# os.environ["LANGFUSE_BASE_URL"] = "https://us.cloud.langfuse.com" # ðŸ‡ºðŸ‡¸ US region

# Your openai and serperdev api key
os.environ["OPENAI_API_KEY"] = "sk-proj-..."
os.environ["SERPERDEV_API_KEY"] = "..."
```

With the environment variables set, we can now initialize the Langfuse client. `get_client()` initializes the Langfuse client using the credentials provided in the environment variables.


```python
from langfuse import get_client
 
langfuse = get_client()
 
# Verify connection
if langfuse.auth_check():
    print("Langfuse client is authenticated and ready!")
else:
    print("Authentication failed. Please check your credentials and host.")
```

### Step 3: Initialize Haystack Instrumentation

Now, we initialize the [OpenInference Haystack instrumentation](https://github.com/Arize-ai/openinference/tree/main/python/instrumentation/openinference-instrumentation-haystack). This third-party instrumentation automatically captures Haystack operations and exports OpenTelemetry (OTel) spans to Langfuse.


```python
from openinference.instrumentation.haystack import HaystackInstrumentor

# Instrument the Haystack application
HaystackInstrumentor().instrument()
```

### Step 4: Create a Simple Haystack Application

Now we create a simple Haystack application using an OpenAI model and the SerperDev search API. 


```python
import os

from haystack.components.agents import Agent
from haystack.components.generators.chat import OpenAIChatGenerator
from haystack.dataclasses import ChatMessage
from haystack.tools import ComponentTool
from haystack.components.websearch import SerperDevWebSearch

search_tool = ComponentTool(component=SerperDevWebSearch())

basic_agent = Agent(
    chat_generator=OpenAIChatGenerator(model="gpt-4o-mini"),
    system_prompt="You are a helpful web agent.",
    tools=[search_tool],
)

result = basic_agent.run(messages=[ChatMessage.from_user("When was the first version of Haystack released?")])

print(result['last_message'].text)

langfuse.flush()

```

### Step 5: View Traces in Langfuse

After running your workflow, log in to [Langfuse](https://cloud.langfuse.com) to explore the generated traces. You will see logs for each workflow step along with metrics such as token counts, latencies, and execution paths. 

![Langfuse Trace Example](https://langfuse.com/images/cookbook/integration_haystack/haystack-example-trace.png)

_[Public example trace in Langfuse](https://cloud.langfuse.com/project/cloramnkj0002jz088vzn1ja4/traces/c1097813c1089faa5ac718bbd0695c73?timestamp=2025-09-02T09%3A53%3A35.005Z&display=details&observation=fdbb095a5e21466b)_
</Steps>

import LearnMore from "@/components-mdx/integration-learn-more.mdx";

<LearnMore />

---
title: "Integrate Claude Code with Langfuse"
sidebarTitle: Claude Code
logo: /images/integrations/anthropic_icon.png
description: "Monitor Claude Code AI coding assistant interactions with Langfuse using hooks for comprehensive observability."
category: Integrations
---

# Claude Code Integration with Langfuse

## What is Claude Code?

[Claude Code](https://docs.anthropic.com/en/docs/claude-code/overview) is Anthropic's agentic coding tool that lives in your terminal. It can understand your codebase, help you write and edit code, execute commands, create and run tests, and help you accomplish complex coding tasks with natural language. Claude Code brings the power of Claude's AI capabilities directly into your development workflow.

## What is Langfuse?

[Langfuse](https://langfuse.com) is the open-source LLM engineering platform. It helps teams trace LLM applications, debug issues, evaluate quality, and monitor costs in production. Langfuse provides comprehensive observability for LLM-powered applications through tracing, metrics, and evaluation tools.

## What Can This Integration Trace?

By using Claude Code's [hooks system](https://docs.anthropic.com/en/docs/claude-code/hooks), this integration captures tool usage events and sends them to Langfuse. You can monitor:

- **Tool invocations**: Track when Claude Code uses tools like file editing, bash commands, or web searches
- **Tool inputs and outputs**: See what data is passed to and returned from each tool
- **Session information**: Group related tool calls into logical sessions
- **Timing information**: Understand how long operations take

## How It Works

Claude Code provides a [hooks system](https://docs.anthropic.com/en/docs/claude-code/hooks) that allows you to run custom scripts at different lifecycle points:

- **PreToolUse**: Before a tool is executed
- **PostToolUse**: After a tool completes
- **Stop**: When a session ends

We'll use these hooks to send telemetry data to Langfuse via the Langfuse Python SDK.

## Quick Start

<Steps>

### Set up Langfuse

1. Sign up for [Langfuse Cloud](https://cloud.langfuse.com) or [self-host Langfuse](/self-hosting).
2. Create a new project and copy your API keys from the project settings.

### Install Dependencies

Install the Langfuse Python SDK:

```bash
pip install langfuse
```

### Create the Hook Script

Create a file called `langfuse_hook.py` in a convenient location (e.g., `~/.claude-code/hooks/langfuse_hook.py`):

```python
#!/usr/bin/env python3
"""
Claude Code Hook: Langfuse Integration
=======================================
This hook sends Claude Code tool usage events to Langfuse for observability.

Configure in your Claude Code settings (~/.claude/settings.json):

{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.claude-code/hooks/langfuse_hook.py"
          }
        ]
      }
    ]
  }
}
"""

import json
import os
import sys
from datetime import datetime

# Initialize Langfuse client
from langfuse import Langfuse

# Initialize Langfuse with environment variables
langfuse = Langfuse(
    public_key=os.environ.get("LANGFUSE_PUBLIC_KEY"),
    secret_key=os.environ.get("LANGFUSE_SECRET_KEY"),
    host=os.environ.get("LANGFUSE_HOST", "https://cloud.langfuse.com"),
)


def main():
    try:
        input_data = json.load(sys.stdin)
    except json.JSONDecodeError as e:
        print(f"Error: Invalid JSON input: {e}", file=sys.stderr)
        sys.exit(1)

    # Extract tool information
    tool_name = input_data.get("tool_name", "unknown")
    tool_input = input_data.get("tool_input", {})
    tool_output = input_data.get("tool_output", {})
    session_id = input_data.get("session_id", "default")

    # Create a trace for this tool usage
    trace = langfuse.trace(
        name=f"claude-code-{tool_name}",
        session_id=session_id,
        metadata={
            "source": "claude-code",
            "tool_name": tool_name,
        },
    )

    # Log the tool usage as a span
    span = trace.span(
        name=tool_name,
        input=tool_input,
        output=tool_output,
        metadata={
            "hook_type": "PostToolUse",
        },
    )

    # Flush to ensure data is sent
    langfuse.flush()

    # Exit successfully (don't block the tool)
    sys.exit(0)


if __name__ == "__main__":
    main()
```

### Make the Script Executable

```bash
chmod +x ~/.claude-code/hooks/langfuse_hook.py
```

### Set Environment Variables

Add the Langfuse credentials to your shell profile (`~/.bashrc`, `~/.zshrc`, etc.):

```bash
# Langfuse Configuration
export LANGFUSE_PUBLIC_KEY="pk-lf-..."
export LANGFUSE_SECRET_KEY="sk-lf-..."
export LANGFUSE_HOST="https://cloud.langfuse.com"  # EU region
# export LANGFUSE_HOST="https://us.cloud.langfuse.com"  # US region
```

Reload your shell:

```bash
source ~/.bashrc  # or source ~/.zshrc
```

### Configure Claude Code Hooks

Add the hook configuration to your Claude Code settings file (`~/.claude/settings.json`):

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.claude-code/hooks/langfuse_hook.py"
          }
        ]
      }
    ]
  }
}
```

<Callout type="info">
The `"matcher": "*"` configuration will capture all tool usage. You can also specify specific tools like `"Bash"`, `"Edit"`, or `"Read"` to only trace certain operations.
</Callout>

### Start Using Claude Code

Now when you use Claude Code, tool usage events will be sent to Langfuse:

```bash
claude
```

### View Traces in Langfuse

Open your Langfuse project to see the captured traces. Each tool invocation will appear as a trace with:

- Tool name
- Input parameters
- Output results
- Session grouping
- Timestamps

</Steps>

## Advanced Configuration

### Tracing Specific Tools Only

To only trace specific tools, modify the matcher in your settings:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.claude-code/hooks/langfuse_hook.py"
          }
        ]
      },
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.claude-code/hooks/langfuse_hook.py"
          }
        ]
      }
    ]
  }
}
```

### Adding Session Start/Stop Hooks

You can also capture session lifecycle events:

```json
{
  "hooks": {
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.claude-code/hooks/langfuse_stop_hook.py"
          }
        ]
      }
    ]
  }
}
```

Create a stop hook script (`langfuse_stop_hook.py`):

```python
#!/usr/bin/env python3
"""Session end hook for Langfuse"""

import json
import os
import sys
from langfuse import Langfuse

langfuse = Langfuse(
    public_key=os.environ.get("LANGFUSE_PUBLIC_KEY"),
    secret_key=os.environ.get("LANGFUSE_SECRET_KEY"),
    host=os.environ.get("LANGFUSE_HOST", "https://cloud.langfuse.com"),
)

def main():
    try:
        input_data = json.load(sys.stdin)
    except json.JSONDecodeError:
        sys.exit(0)

    session_id = input_data.get("session_id", "default")
    
    # Log session end
    trace = langfuse.trace(
        name="claude-code-session-end",
        session_id=session_id,
        metadata={
            "source": "claude-code",
            "event": "session_end",
        },
    )
    
    langfuse.flush()
    sys.exit(0)

if __name__ == "__main__":
    main()
```

## Troubleshooting

### No traces appearing in Langfuse

1. Verify the hook script is executable: `chmod +x ~/.claude-code/hooks/langfuse_hook.py`
2. Check that environment variables are set: `echo $LANGFUSE_PUBLIC_KEY`
3. Test the script manually: `echo '{"tool_name": "test"}' | python3 ~/.claude-code/hooks/langfuse_hook.py`
4. Check the Langfuse SDK is installed: `pip show langfuse`

### Hook script errors

Hook scripts that exit with code 1 show errors to the user. Exit code 0 is for success, exit code 2 blocks the tool call.

Test your script in isolation before configuring it as a hook:

```bash
echo '{"tool_name": "Bash", "tool_input": {"command": "ls"}}' | python3 ~/.claude-code/hooks/langfuse_hook.py
```

### Authentication errors

Verify your Langfuse API keys are correct and the host URL matches your region (EU or US).

## Resources

- [Claude Code Documentation](https://docs.anthropic.com/en/docs/claude-code/overview)
- [Claude Code Hooks](https://docs.anthropic.com/en/docs/claude-code/hooks)
- [Claude Code GitHub Repository](https://github.com/anthropics/claude-code)
- [Langfuse Python SDK](/docs/sdk/python/sdk-v3)
- [Langfuse Documentation](https://langfuse.com/docs)
